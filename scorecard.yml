- name: OSSF Scorecard action
  uses: ossf/scorecard-action@v2.4.1

  on:
    push:
      branches:
        - main
    pull_request:
      branches:
        - main

  jobs:
    scorecard:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Run OSSF Scorecard
          uses: ossf/scorecard-action@v2.4.1
          id: scorecard

        - name: Display Scorecard Results
          run:
            echo "Scorecard Results: ${{ steps.scorecard.outputs.scorecard_json }}"

        - name: Upload Scorecard Results as Artifact
          uses: actions/upload-artifact@v2
          with:
            name: scorecard-results
            path: scorecard.json

        - name: Create Badge
          run: |
            SCORECARD_RESULT=$(echo ${{ steps.scorecard.outputs.scorecard_json }} | jq '.status')
            if [[ "$SCORECARD_RESULT" == "PASS" ]]; then
              BADGE_COLOR="brightgreen"
            else
              BADGE_COLOR="red"
            fi
            curl -s "https://img.shields.io/badge/OSS%20Scorecard-$SCORECARD_RESULT-$BADGE_COLOR" -o badge.svg
            echo "![OSS Scorecard](badge.svg)" > scorecard-badge.md
